<%- include('../partials/header') %>

<!-- Hero Slider -->
<div id="heroCarousel" class="carousel slide hero-slider" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
    </div>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="/uploads/gallery/thuong-hieu-da-duoc-khang-dinh-tu-nam-2000-1729586823.jpg" class="d-block w-100" alt="Thương hiệu đã được khẳng định từ năm 2000">
            <div class="carousel-caption">
                <h1>Thương Hiệu Bánh Ngon</h1>
                <p>Đã được khẳng định từ năm 2000</p>
                <a href="/san-pham" class="btn btn-view-more">Xem thêm</a>
            </div>
        </div>
        <div class="carousel-item">
            <img src="/uploads/gallery/banh-sinh-nhat-cong-chua-1729586874.jpg" class="d-block w-100" alt="Bánh sinh nhật công chúa">
            <div class="carousel-caption">
                <h1>Bánh Sinh Nhật Đẹp</h1>
                <p>Thiết kế độc đáo, phù hợp mọi dịp</p>
                <a href="/san-pham" class="btn btn-view-more">Xem thêm</a>
            </div>
        </div>
        <div class="carousel-item">
            <img src="/uploads/gallery/banh-luon-tuoi-luon-moi-tai-cua-hang-1729586705.jpg" class="d-block w-100" alt="Bánh luôn tươi luôn mới tại cửa hàng">
            <div class="carousel-caption">
                <h1>Bánh Tươi Mới</h1>
                <p>Được làm mới mỗi ngày tại cửa hàng</p>
                <a href="/san-pham" class="btn btn-view-more">Xem thêm</a>
            </div>
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- Giới thiệu -->
<section class="intro-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <img src="/images/store-front.jpg" alt="Anh Quân Bakery" class="img-fluid rounded">
            </div>
            <div class="col-md-6">
                <div class="intro-content">
                    <h2>VỀ CHÚNG TÔI</h2>
                    <p>Anh Quân Bakery tự hào là thương hiệu bánh với hơn 10 năm kinh nghiệm, chuyên cung cấp các loại bánh mì, bánh ngọt, bánh kem chất lượng cao. Chúng tôi cam kết mang đến cho khách hàng những sản phẩm tươi ngon nhất với giá cả hợp lý.</p>
                    <div class="core-values">
                        <div class="value-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Nguyên liệu tươi sạch</span>
                        </div>
                        <div class="value-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Công nghệ hiện đại</span>
                        </div>
                        <div class="value-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Dịch vụ chuyên nghiệp</span>
                        </div>
                    </div>
                    <a href="/gioi-thieu" class="btn btn-outline-primary">TÌM HIỂU THÊM</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Danh mục sản phẩm -->
<section class="product-categories">
    <div class="container">
        <div class="section-title">
            <h2>DANH MỤC SẢN PHẨM</h2>
        </div>
        <div class="owl-carousel owl-theme category-slider">
            <% categories.forEach(function(category) { %>
                <div class="item">
                    <a href="/danh-muc/<%= category.id %>" class="category-card">
                        <div class="category-img">
                            <img src="/images/categories/<%= category.id %>.jpg" alt="<%= category.name %>">
                        </div>
                        <h3><%= category.name %></h3>
                    </a>
                </div>
            <% }); %>
        </div>
    </div>
</section>

<!-- Sản phẩm nổi bật -->
<section class="featured-products">
    <div class="container">
        <div class="section-title">
            <h2>SẢN PHẨM NỔI BẬT</h2>
        </div>
        <div class="row">
            <% products.forEach(function(product) { %>
                <div class="col-md-3 col-6 mb-3">
                    <div class="product-card" data-product-id="<%= product.id %>">
                        <div class="product-img">
                            <a href="/san-pham/<%= product.id %>">
                                <img src="<%= product.image_url %>" alt="<%= product.name %>">
                            </a>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">
                                <a href="/san-pham/<%= product.id %>">
                                    <%= product.name.length > 20 ? product.name.substring(0, 20) + '...' : product.name %>
                                </a>
                            </h3>
                            <div class="price"><%= new Intl.NumberFormat('vi-VN').format(product.price) %> VNĐ</div>
                            <button class="btn btn-primary add-to-cart">
                                <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                            </button>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
</section>

<!-- Tin tức & Sự kiện -->
<section class="news-section">
    <div class="container">
        <div class="section-title">
            <h2>TIN TỨC & SỰ KIỆN</h2>
        </div>
        <div class="row">
            <% if (recentNews && recentNews.length > 0) { %>
                <% recentNews.forEach(function(news) { %>
                    <div class="col-md-4">
                        <div class="news-card">
                            <% if (news.image) { %>
                                <img src="<%= news.image %>" alt="<%= news.title %>">
                            <% } else { %>
                                <img src="/images/news-placeholder.jpg" alt="<%= news.title %>">
                            <% } %>
                            <div class="news-content">
                                <h3><%= news.title %></h3>
                                <p><%= news.summary.length > 100 ? news.summary.substring(0, 100) + '...' : news.summary %></p>
                                <a href="/tin-tuc/<%= news.slug %>" class="btn btn-outline-primary">XEM THÊM</a>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="col-12 text-center">
                    <p>Chưa có tin tức mới.</p>
                </div>
            <% } %>
        </div>
        <div class="text-center mt-4">
            <a href="/tin-tuc" class="btn btn-primary">Xem tất cả tin tức</a>
        </div>
    </div>
</section>

<%- include('../partials/footer') %>

<!-- Add Toast Styles -->
<style>
.toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-radius: 8px;
    padding: 16px;
    min-width: 300px;
    z-index: 1000;
}

.toast.success {
    border-left: 4px solid #4caf50;
}

.toast-content {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.toast-content i {
    color: #4caf50;
    font-size: 20px;
}

.toast-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

.btn-outline {
    padding: 6px 12px;
    border: 1px solid #ddd;
    background: white;
    color: #333;
    border-radius: 4px;
    text-decoration: none;
}

.btn-text {
    padding: 6px 12px;
    border: none;
    background: none;
    color: #666;
    cursor: pointer;
}
</style>
<script>
$(document).ready(function(){
    $('.category-slider').owlCarousel({
        loop: true,
        margin: 20,
        nav: true,
        dots: false,
        autoplay: true,
        autoplayTimeout: 5000,
        autoplayHoverPause: true,
        responsive:{
            0:{
                items: 2
            },
            600:{
                items: 3
            },
            1000:{
                items: 4
            }
        }
    });
});
document.addEventListener('DOMContentLoaded', function() {
    // Add to cart functionality
    const addToCartButtons = document.querySelectorAll('.add-to-cart');
    
    addToCartButtons.forEach(button => {
        button.addEventListener('click', function() {
            const productCard = this.closest('.product-card');
            const productId = productCard.dataset.productId;
            const quantity = 1; // Default quantity
            // Show loading state
            button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Đang thêm...';
            button.disabled = true;
            fetch(`/gio-hang/items/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ quantity })
            })
            .then(response => {
                if (response.status === 401) {
                    // Chưa đăng nhập - chuyển hướng đến trang đăng nhập
                    window.location.href = '/auth/dang-nhap';
                    return;
                }
                 //                 // Reset button state
                    button.innerHTML = 'Đã thêm vào giỏ';
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-success');
                    

            })
            .then(data => {
                if (!data) return; // Nếu đã chuyển hướng đến trang đăng nhập
                
                if (data.message) {
                    console.log("data", data.message);
                    // Hiển thị thông báo thành công
                    const toast = document.createElement('div');
                    toast.className = 'toast success';
                    toast.innerHTML = `
                        <div class="toast-content">
                            <i class="bi bi-check-circle"></i>
                            <span>Đã thêm ${quantity} sản phẩm vào giỏ hàng</span>
                        </div>
                        <div class="toast-actions">
                            <a href="/gio-hang" class="btn btn-outline">Xem giỏ hàng</a>
                            <button class="btn btn-text" onclick="this.parentElement.parentElement.remove()">Đóng</button>
                        </div>
                    `;
                    document.body.appendChild(toast);
                    
                    // Tự động ẩn toast sau 5 giây
                    setTimeout(() => {
                        toast.remove();
                    }, 5000);

                    // Cập nhật số lượng trong giỏ hàng trên header (nếu có)
                    const cartBadge = document.querySelector('.cart-badge');
                    if (cartBadge) {
                        const currentCount = parseInt(cartBadge.textContent) || 0;
                        cartBadge.textContent = currentCount + quantity;
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra khi thêm vào giỏ hàng');
            });
        });
    });
});
</script> 